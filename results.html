<!DOCTYPE HTML>

<html>
	<head>
		<title>VIKA - Results</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<meta name="description" content="JOIN THE VIKA COMMUNITY. Develop Respectful Driving Skills. Build Lasting Relationships.">
		<meta name="keywords" content="karting, racing, driving, go kart, kart, victoria, VIMC, VIKA">
		
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-M1GJR3SM3X"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

			gtag('config', 'G-M1GJR3SM3X');
		</script>
	</head>
	<body class="is-preload">

		<!-- Page wrapper -->
			<div id="page-wrapper">

				<!-- Header -->
					<header id="header">
						<span class="logo"> <span>Vancouver Island</span> <a href="index.html">Karting Association</a></span>

						<a href="#menu">Menu</a>
					</header>

				<!-- Nav -->
					<nav id="menu">
						<div class="inner">
							<h2>Menu</h2>
							<ul class="links">
								<li><a href="index.html">Home</a></li>
								<li><a href="about.html">About</a></li>
								<li><a href="news.html">News</a></li>
								<li><a href="index.html#schedule">Schedule</a></li>
								<li><a href="results.html">Results</a></li>
								<li><a href="membership.html">Membership</a></li>
								<li><a href="faq.html">FAQ</a></li>
								<li><a href="rules.html">Rules</a></li>
								<li><a href="gallery.html">Gallery</a></li>
								<li><a href="index.html#contact">Contact</a></li>
							</ul>
							<a class="close">Close</a>
						</div>
					</nav>

				<!-- Main -->
					<section id="main" class="wrapper style1 " style="					
					background-image: linear-gradient(to top, rgba(43, 90, 150, 0.9), rgba(43, 90, 150, 0.9)), url(./images/banner.jpg);
					background-attachment: fixed;
					background-position: center center;
					background-size: cover;
					color: white;">
						<div class="inner">

							<header class="major special">
								<p>Updated 2022-02-09</p>
								<h1>Results</h1>
							</header>
						</div>
					</section>

					<section id="" class="wrapper alt">
						<div class="inner">

							<h1>2022 Spring/Summer Series Results</h1>

							<p>
								Scoring is based off of WCKC rules.
							</p>

							<div id="results-data-summer-2022"></div>

						</div>
					</section>

					<section id="" class="wrapper alt">
						<div class="inner">

							<h1>2022 Winter Series Results</h1>

							<p>
								Scoring is based off of final race results. <br> See position to score graph at bottom of the page.
							</p>

							<div id="results-data"></div>

							<br>
							<h3>Position to score graph </h3>
							<div class="image main"><img style="max-width: 800px;" src="images/points_breakdown.png" alt="" /></div>

						</div>
					</section>

	<!-- Footer -->
	<footer id="footer">
		<div class="inner" id="contact">
			<ul class="contact">
				<li class="icon solid fa-home">
					<strong>Address</strong>
					974 Taine Place, <br>Victoria, V8X 4A4
				</li>
				<li class="icon solid fa-phone">
					<strong>Phone</strong>
					(250) 514-8888
				</li>
				<li class="icon solid fa-envelope">
					<strong>Email</strong>
					info@vika.ca
				</li>
			</ul>
			<form>
				<h4>Get in touch</h4>
				<div class="fields">
					<div class="field half">
						<label for="name">Name</label>
						<input name="name" id="name" type="text" placeholder="Name">
					</div>
					<div class="field half">
						<label for="email">Email</label>
						<input name="email" id="email" type="email" placeholder="Email">
					</div>
					<div class="field">
						<label for="message">Message</label>
						<textarea name="message" id="message" rows="6" placeholder="Message"></textarea>
					</div>
				</div>
				<ul class="actions">
					<li><input onclick="sendContactMessage();" id="send-button" type="submit" value="Send Message" /></li>
				</ul>
			</form>
		</div>

		<div class="inner" id="sponsors" >
			<h2>2022 Sponsors</h2>
			<div class="box alt">
				<div class="row gtr-50 gtr-uniform sponsor-images">
					<div class="col-8"><span class="image fit"><a href="https://islandjunk.com/" target="_blank"><img src="images/island_junk.png" alt=""></a></span></div>
				</div>
				<div class="row gtr-50 gtr-uniform sponsor-images">
					<div class="col-6"><span class="image fit"><a href="https://ignitionmotorsports.ca/" target="_blank"><img src="images/ignition_motorsport.png" alt=""></a></span></div>
					<div class="col-6"><span class="image fit"><a href="https://playsted.com/" target="_blank"><img src="images/playsted.png" alt=""></a></span></div>
				</div>
				<div class="row gtr-50 gtr-uniform sponsor-images">
					<div class="col-2"><span class="image fit"><a href="https://heikescontracting.com/" target="_blank"><img src="images/heikeshomes.png" alt=""></a></span></div>
					<div class="col-4"><span class="image fit"><a href="https://www.junctionvictoria.com/" target="_blank"><img src="images/juncation orchard & cidery.webp" alt=""></a></span></div>
					<div class="col-4"><span class="image fit"><a href="https://smartwashvictoria.godaddysites.com/" target="_blank"><img src="images/smartwashvictoria.webp" alt=""></a></span></div>
				</div>
			</div>
		</div>

		<div class="copyright">
			&copy; Vancouver Island Karting Association. All rights reserved.
			<br>
			Site created by <a style="color: #bbb; text-decoration: none;" target="_blank" href="https://mnursey.github.io/">Mitchell Nursey</a>
		</div>
	</footer>

</div>

<!-- Scripts -->


<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/browser.min.js"></script>
<script src="assets/js/breakpoints.min.js"></script>
<script src="assets/js/util.js"></script>
<script src="assets/js/jquery.scrollex.min.js"></script>
<script src="assets/js/jquery.scrolly.min.js"></script>
<script src="assets/js/main.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.1/papaparse.js"></script>

		<!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->

<!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-app.js"></script>

<!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-analytics.js"></script>

<!-- Add Firebase products that you want to use -->
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-firestore.js"></script>

<script>

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
	apiKey: "AIzaSyAIZS44jNWIFGO4Dex6fe3AryepEIVihRc",
	authDomain: "jsform2mail.firebaseapp.com",
	projectId: "jsform2mail",
	storageBucket: "jsform2mail.appspot.com",
	messagingSenderId: "27543160639",
	appId: "1:27543160639:web:fbbde6690315ceef29f58a",
	measurementId: "G-3X4H4KH79V"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

function sendContactMessage() {

	let name = document.getElementById("name").value;
	let email = document.getElementById("email").value;
	let message = document.getElementById("message").value;

	message = name + "\n" + email + "\n\n\n" + message;

	db.collection("mail").doc().set({
		to: ["mitchnursey@gmail.com"],
		message : {
			subject : "VIKA, message from " + name,
			text : message
		}
	})
	.then(() => {
		console.log("Contact message successfully written!");
	})
	.catch((error) => {
		console.error("Error writing message: ", error);
	});

	document.getElementById("send-button").value = "Message sent";
	document.getElementById("send-button").disabled = true;
}

var resultsData = {};
var resultsDataSummer2022 = {};

var qualifyingPositionToPoints = {
	1 : 100,
	2 : 85,
	3 : 75,
	4 : 65,
	5 : 55,
	6 : 50,
	7 : 45,
	8 : 40,
	9 : 35,
	10 : 30,
	11 : 25,
	12 : 20,
	13 : 15,
	14 : 10,
	15 : 5,
	16 : 5,
	17 : 5,
	18 : 5,
	19 : 5,
	20 : 5,
	21 : 5,
	22 : 5,
	23 : 5,
	24 : 5,
	25 : 5,
	'DQ' : 0,
	'' : 0
};

var prefinalPositionToPoints = {
	1 : 200,
	2 : 175,
	3 : 155,
	4 : 140,
	5 : 130,
	6 : 120,
	7 : 110,
	8 : 100,
	9 : 90,
	10 : 80,
	11 : 75,
	12 : 70,
	13 : 65,
	14 : 60,
	15 : 55,
	16 : 50,
	17 : 45,
	18 : 40,
	19 : 35,
	20 : 30,
	21 : 25,
	22 : 20,
	23 : 15,
	24 : 10,
	25 : 5,
	'DQ' : 0,
	'' : 0
};

var finalPositionToPoints = {
	1 : 300,
	2 : 250,
	3 : 210,
	4 : 185,
	5 : 150,
	6 : 130,
	7 : 120,
	8 : 110,
	9 : 100,
	10 : 90,
	11 : 80,
	12 : 75,
	13 : 70,
	14 : 65,
	15 : 60,
	16 : 55,
	17 : 50,
	18 : 45,
	19 : 40,
	20 : 35,
	21 : 30,
	22 : 25,
	23 : 20,
	24 : 15,
	25 : 10,
	'DQ' : 0,
	'' : 0
};

Papa.parse("https://vika.ca/points_csv.csv", {
	download: true,
	header: true,
	step: function(row) {
		//console.log("Row:", row.data);
		let data = row.data;
		if(data['Driver'] != "" && !(data['Class'] in resultsData)) {
			resultsData[data['Class']] = [];
		}

		if(data['Driver'] != "" && data['Class'] != "") {
			resultsData[data['Class']].push(row.data);
		}
	},
	complete: function() {

		let html = "";

		for(var classGroup in resultsData){

			html += `
				<h3> ` + classGroup + `</h3>
				<div class="table-wrapper">
								<table style="max-width: 800px;">
									<thead>
										<tr>
											<th style="width: 300px;">Name</th>
											<th>Race 1</th>
											<th>Race 2</th>
											<th>Race 3</th>
											<th>Total</th>
										</tr>
									</thead>
									<tbody>
			`;

			
			for(var i in resultsData[classGroup]) {
				let driver = resultsData[classGroup][i];

				html += `
				
				<tr>
					<td>` + driver['Driver'] + `</td>
					<td>` + driver['Race 1'] + `</td>
					<td>` + driver['Race 2'] + `</td>
					<td>` + driver['Race 3'] + `</td>
					<td>` + driver['Total'] + `</td>

				</tr>

				`;
			}

			html += `
						</tbody>
					</table>
				</div>

				<br>
			`;
		}

	
		document.getElementById("results-data").innerHTML = html;
	}
});


Papa.parse("https://vika.ca/2022_summer_series_positions.csv", {
	download: true,
	header: true,
	step: function(row) {
		//console.log("Row:", row.data);
		let data = row.data;
		if(data['Name'] != "" && !(data['Class'] in resultsDataSummer2022)) {
			resultsDataSummer2022[data['Class']] = [];
		}

		if(data['Name'] != "" && data['Class'] != "") {
			resultsDataSummer2022[data['Class']].push(row.data);
		}
	},
	complete: function() {
		//console.log("All done!");
		//console.log(resultsDataSummer2022);

		let html = "";

		for(var classGroup in resultsDataSummer2022){

			if(resultsDataSummer2022[classGroup].length > 0) {
				html += `
				<h3> ` + classGroup + `</h3>
				<div class="table-wrapper">
								<table style="max-width: 800px;">
									<thead>
										<tr>
											<th>Standing</th>
											<th style="width: 300px;">Name</th>
											<th>Race 1 <br>(Qualify, Pre-Final, Final)</th>
											<th>Race 2 <br>(Qualify, Pre-Final, Final)</th>
											<th>Total</th>
										</tr>
									</thead>
									<tbody>
			`;
			} else {
				continue;
			}


			
			let q = function(a) {
				a = parseInt(a);
				if(a) {
					return qualifyingPositionToPoints[a];
				} else {
					return 0;
				}
			};

			let p = function(a) {
				a = parseInt(a);
				if(a) {
					return prefinalPositionToPoints[a];
				} else {
					return 0;
				}
			};

			let f = function(a) {
				a = parseInt(a);
				if(a) {
					return finalPositionToPoints[a];
				} else {
					return 0;
				}
			};

			for(var i in resultsDataSummer2022[classGroup]) {
				let driver = resultsDataSummer2022[classGroup][i];
				//console.log(driver);

				driver['race1Points'] = q(driver['Race 1 - Qualifying']) + p(driver['Race 1 - Pre-final']) + f(driver['Race 1 - Final']);
				driver['race2Points'] = q(driver['Race 2 - Qualifying']) + p(driver['Race 2 - Pre-final']) + f(driver['Race 2 - Final']);

				driver['total'] = driver['race1Points'] + driver['race2Points'];
			}

			resultsDataSummer2022[classGroup].sort(function(a, b){
				
				if(a['total'] > b['total']) {
					return -1;
				}

				if(a['total'] < b['total']) {
					return 1;
				}
				
				return 0;
			});

			for(var i in resultsDataSummer2022[classGroup]) {

				let driver = resultsDataSummer2022[classGroup][i];

				if(driver['total'] > 0 && driver['hide'] != 'x') {
					html += `
				
					<tr>
						<td>` + (parseInt(i) + 1) + `</td>
						<td>` + driver['Name'] + `</td>
						<td>` + q(driver['Race 1 - Qualifying']) + ', ' + p(driver['Race 1 - Pre-final']) +  ', ' + f(driver['Race 1 - Final']) + ' <br> Total: '+ driver['race1Points'] + `</td>
						<td>` + q(driver['Race 2 - Qualifying']) + ', ' + p(driver['Race 2 - Pre-final']) +  ', ' + f(driver['Race 2 - Final']) + ' <br> Total: '+ driver['race2Points'] + `</td>
						<td>` + driver['total'] + `</td>

					</tr>

					`;
				}
			}


			if(resultsDataSummer2022[classGroup].length > 0) {

				html += `
							</tbody>
						</table>
					</div>

					<br>
				`;
			}
		}

	
		document.getElementById("results-data-summer-2022").innerHTML = html;
	}
});


</script>

</body>
</html>